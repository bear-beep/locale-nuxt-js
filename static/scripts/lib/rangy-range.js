define(["rangy-core"],function(c){var h={"fontSubscript":"fontSupscript","fontSupscript":"fontSubscript"},a=["zImg"];var w={breakSpan:m,removeAllStyle:e,coverStyle:k,isAddStyle:p,insertToRange:q,changeSpecialStyle:j};return w;function q(D,y,B){D=u(D).dom;if(B){y.deleteContents()}var C=y.startOffset,A=y.startContainer,z=f(A,C);if(z.is("div")){z.prepend(D)}else{if(A.nodeType==3&&C<A.length){m(z,C)}z.after(D)}y.collapseAfter(D[0]);y.select();return y}function j(A,y,z){if(typeof A=="array"&&y.collapsed){return false}y=x(A,y,z);y.select();return y}function p(z,B){var y,D,C=z.cloneContents().childNodes;for(var A=0;A<C.length;A++){D=C[A];if(D.nodeType==3){if(A==0){y=s(z.startContainer,B)}else{if(A==C.length){y=s(z.endContainer,B)}}}else{y=s(C[A],B)}if(!y){return true}}return false}function k(A,y){if(y.collapsed){return false}var z=u(A);y=r(z,y);y.select();return y}function e(y){if(y.collapsed){return false}y=i(y);y.select();return y}function m(B,D){var C=B.text(),y=C.substring(0,D),z=C.substring(D),A=B.clone(true);B.text(y);A.text(z);B.after(A);return A}function i(D){var C,z,B,y,H="",G=(D.startContainer===D.endContainer),E=$('<span class="fontText"></span>'),F=$('<span class="fontText zImg"></span>'),I=$(D.startContainer).hasClass("textarea_container ");if(I){z=$(D.startContainer).children("span");C=$("<span></span>");$(D.startContainer).html(C)}else{z=D.extractContents().childNodes;C=f(D.startContainer,D.startOffset)}if(G&&!I){y=m(g(D.startContainer),D.startOffset)}for(var A=0;A<z.length;A++){B=z[A];if($(B).hasClass("zImg")){if(H!=""){C=t(E.clone(),H,C);H=""}C=t(F.clone(),B.innerHTML,C)}else{if(B.nodeType==3){H+=B.textContent}else{H+=B.innerHTML}}}C=t(E,H,C);D.setEndAfter(C[0]);D.collapse(false);return D}function x(O,E,C){var D,M,L,z,y,B,J,A,F,K,H=(E.startContainer===E.endContainer),Q=$(E.startContainer).hasClass("textarea_container ");if(Q){var N=$(E.startContainer).children("span");for(var I=0;I<N.length;I++){var P=N.eq(I);o(O,P,C)}}else{if(H){z=l(E.commonAncestorContainer,E.startOffset,E.endOffset);M=z.spanCopy;L=o(O,M,C);E.deleteContents();D=m(g(E.startContainer),E.startOffset);D.before(L);E.selectNodeContents(L[0].childNodes[0])}else{z=l(E.startContainer,E.startOffset);B=z.spanCopy;y=z.span;B=o(O,B,C);z=l(E.endContainer,null,E.endOffset);A=z.spanCopy;F=z.span;A=o(O,A,C);J=E.extractContents().childNodes;y.after(B);E.setStart(B[0].childNodes[0],0);K=J.length;for(var I=1;I<K-1;I++){L=o(O,$(J[I]),C);L=L.clone();B.after(L);B=L}F.before(A);var G=A[0].childNodes[0];if(G.length){E.setEnd(G,G.length)}else{E.setEndAfter(G)}}}return E}function l(F,y,A){var E,C,z,D,B=F;if($(F).is("div")){D=y?y:A;C=$(F).children().eq(D);z=C.clone()}else{y=y?y:0;while(!(B.tagName&&B.tagName=="SPAN")){B=B.parentNode}C=$(B);z=C.clone();E=C.text();if(E!=""){E=E.substring(y,A);z.text(E)}}return{span:C,spanCopy:z}}function r(y,G){var K,E,F,A,D,z,B,L="",J=(G.startContainer===G.endContainer),H=y.dom,I=$('<span class="fontText zImg"></span>');A=G.extractContents().childNodes;F=f(G.startContainer,G.startOffset);if(J){z=m(g(G.startContainer),G.startOffset)}for(var C=0;C<A.length;C++){D=A[C];if($(D).hasClass("zImg")){if(L!=""){F=t(H.clone(),L,F);L=""}F=t(I.clone(),D.innerHTML,F)}else{if(D.nodeType==3){L+=D.textContent}else{L+=D.innerHTML}}}F=t(H,L,F);G.setEndAfter(F[0]);G.collapse(false);return G}function t(A,z,y){A.html(z);y.after(A);return A}function o(C,B,y){var A;for(var z=0;z<C.length;z++){if(y){if(!b(B)){A=C[z];B.addClass(A);n(A,B)}}else{B.removeClass(C[z])}}return B}function n(z,A){var y=h[z];if(y){A.removeClass(y)}}function g(z){var y=z;while(!(y.tagName&&y.tagName=="SPAN")){y=y.parentNode}return $(y)}function f(z,B){var y=z;while(y.nodeType==3){y=y.parentNode}var A=$(y);if(A.is("div")&&A.children().length>0){A=v(A,B)}return A}function v(B,A){var z=B[0].childNodes,y=$(z[A-1]);if(y.length==0){y=B}return y}function u(z){z=z.clone();var y=z.attr("class").split(" ");y=d(y);z.attr("class",y.join(" "));return{"dom":z,"classNames":y}}function d(B){var z,A={"fontBold":true,"fontItatic":true,"fontUnder":true,"fontSubscript":true,"fontSupscript":true,"fontColor":true,"fontLink":true,"zImg":true,"fontText":true};for(var y=0;y<B.length;y++){z=B[y];if(!A[z]){B.splice(y,1)}}return B}function s(A,y){var z=g(A);if(b(z)){return true}return z.hasClass(y)}function b(A){for(var y=0;y<a.length;y++){var z=a[y];if(A.hasClass(z)){return z}}return null}});